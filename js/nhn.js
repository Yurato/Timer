/* release date : 2014-02-10 */
if(typeof nhn=="undefined"){nhn={};}nhn.search=nhn.search||{};nhn.search.timer=nhn.search.timer||{};nhn.search.timer.TimeStepper=jindo.$Class({$init:function(a){if(a){this.initalize(a);}},initalize:function(a){this.option({container:null,selecter:{timeInputs:"span.roll_bg > input.num",btnUp:"a.btn_up",btnDown:"a.btn_down"},max:59,overflow:false,underflow:false});this.option(a||{});this._assignElement();this._attachEvent();this._configure();},_assignElement:function(){var a=this.option("selecter");this._elCtn=this.option("container");this._htElement={};this._welTimeInputs=jindo.$ElementList(jindo.$$(a.timeInputs,this._elCtn));this._elNextButton=jindo.$$.getSingle(a.btnUp,this._elCtn);this._elPrevButton=jindo.$$.getSingle(a.btnDown,this._elCtn);this._welTimeInput0=this._welTimeInputs.get(0);this._welTimeInput1=this._welTimeInputs.get(1);},_configure:function(){this._max=(this.option.max||59);this._overflow=(this.option.overflow===true)||false;this._underflow=(this.option.underflow===true)||false;this._nValue=0;this.isLocked=false;},_attachEvent:function(){var g=jindo.$Fn(this._onNextButtonClickHandler,this);g.attach(this._elNextButton,"click");var f=jindo.$Fn(this._onPrevButtonClickHandler,this);f.attach(this._elPrevButton,"click");var b=this._welTimeInputs.$value();var e=jindo.$Fn(this._onInputFocusHandler,this);e.attach(b,"focus");var c=jindo.$Fn(this._onInputFocusHandler,this);c.attach(b,"blur");var a=jindo.$Fn(this._onInputKeypressHandler,this);a.attach(b,"keypress");var d=jindo.$Fn(this._onInputChangeHandler,this);d.attach(b,"change");},_onInputFocusHandler:function(b){if(this.isLocked){return;}var a=jindo.$Element(b.element);var c=b.type;if(c=="focus"){this._beforeValue=a.text();a.text("");}else{if(c=="blur"){if(a.text()==""){a.text(this._beforeValue);}}}},_onInputChangeHandler:function(b){var a=this._welTimeInput0.text()*10+this._welTimeInput1.text()*1;this.setValue(a);},_onInputKeypressHandler:function(b){var a=/[\d]/g;if(!(String.fromCharCode(b.key().keyCode).match(a))){jindo.$Element(b.currentElement).text("");b.stopDefault();return;}},_onNextButtonClickHandler:function(){if(this._nValue<this._max||this._overflow){this.fireEvent("change",{condition:"next"});this.increment();}},_onPrevButtonClickHandler:function(){if(this._nValue>0||this._underflow){this.fireEvent("change",{condition:"prev"});}this.decrement();},getValue:function(){return this._nValue;},setValue:function(a,b){if(this._nValue===a){return;}this._nValue=a;this._welTimeInput0.text(Math.floor(this._nValue/10)+"");this._welTimeInput1.text(this._nValue%10+"");this.fireEvent("change",{condition:b});},decrement:function(a){var b=this._nValue-((a===undefined)?1:a);var c;if(b<0){if(this._underflow){b+=(this._max+1);c="underflow";}else{b=0;}}this.setValue(b);},increment:function(a){var b=this._nValue+((a===undefined)?1:a);var c;if(b>this._max){if(this._overflow){b-=(this._max+1);c="overflow";}else{b=this._max;}}this.setValue(b);},reset:function(){if(this.isLocked){return;}this.setValue(0);},setLocked:function(c){this.isLocked=c;var b=this._welTimeInput0.$value();var a=this._welTimeInput1.$value();if(c){b.setAttribute("readonly");a.setAttribute("readonly");}else{if(b.hasAttribute("readonly")){b.removeAttribute("readonly");}if(a.hasAttribute("readonly")){a.removeAttribute("readonly");}}}}).extend(jindo.Component);nhn.search.timer.Timer=jindo.$Class({$init:function(a){if(a){this.initalize(a);}},initalize:function(a){this.option({containerID:"_cs_timer",isPopup:false,selecter:{hour:"div.timer_area > div.time_set > div.hour_area",minute:"div.timer_area > div.time_set > div.minute_area",second:"div.timer_area > div.time_set > div.second_area",btnAddTimes:"div.time_help > ul > li > a",btnRun:"div.timer_area > div.btn_area > button._run",btnReset:"div.timer_area > div.btn_area > button.btn_reset",layerAlert:"div.pop_up",alertTime:"div.pop_up > span",btnAlertConform:"div.pop_up > a.btn_conform",btnAlertClose:"div.pop_up > a.btn_close",btnTimerPopup:"div.time_help > a.btn_popup",btnCloseWindow:"div.btn_time > a.btn_timeclose",},popupInfo:{url:"popup.html",width:"590",height:"160"}});this.option(a||{});this._assignElement();this._configure();this._attachEvent();},_assignElement:function(){var a=this.option("selecter");this._elCtn=jindo.$(this.option("containerID"));this._htElement={};this._htElement.hour=jindo.$$.getSingle(a.hour,this._elCtn);this._htElement.minute=jindo.$$.getSingle(a.minute,this._elCtn);this._htElement.second=jindo.$$.getSingle(a.second,this._elCtn);this._htElement.btnAddTimes=jindo.$$(a.btnAddTimes,this._elCtn);this._htElement.wBtnRun=jindo.$Element(jindo.$$.getSingle(a.btnRun,this._elCtn));this._htElement.wBtnReset=jindo.$Element(jindo.$$.getSingle(a.btnReset,this._elCtn));this._htElement.wAlert=jindo.$Element(jindo.$$.getSingle(a.layerAlert,this._elCtn));this._htElement.wAlertTime=jindo.$Element(jindo.$$.getSingle(a.alertTime,this._elCtn));this._htElement.btnAlertConform=jindo.$$.getSingle(a.btnAlertConform,this._elCtn);this._htElement.btnAlertClose=jindo.$$.getSingle(a.btnAlertClose,this._elCtn);if(this.option("isPopup")){this._htElement.btnCloseWindow=jindo.$$.getSingle(a.btnCloseWindow,this._elCtn);}else{this._htElement.btnTimerPopup=jindo.$$.getSingle(a.btnTimerPopup,this._elCtn);}this._oHourStepper=new nhn.search.timer.TimeStepper({container:this._htElement.hour,max:99,overflow:false});this._oMinuteStepper=new nhn.search.timer.TimeStepper({container:this._htElement.minute});this._oSecondStepper=new nhn.search.timer.TimeStepper({container:this._htElement.second,underflow:false});},_attachEvent:function(){var a=jindo.$Fn(this._onClickBtnAddTimesHandler,this);a.attach(this._htElement.btnAddTimes,"click");var f=jindo.$Fn(this._onClickBtnRunHandler,this);f.attach(this._htElement.wBtnRun.$value(),"click");var d=jindo.$Fn(this._onClickBtnResetHandler,this);d.attach(this._htElement.wBtnReset.$value(),"click");var c=jindo.$Fn(this._onClickAlertCloseHandler,this);c.attach(this._htElement.btnAlertConform,"click");var e=jindo.$Fn(this._onClickAlertCloseHandler,this);e.attach(this._htElement.btnAlertClose,"click");if(this.option("isPopup")){var b=jindo.$Fn(this._onClickCloseWindow,this);b.attach(this._htElement.btnCloseWindow,"click");}else{var g=jindo.$Fn(this._onClickOpenTimerPopup,this);g.attach(this._htElement.btnTimerPopup,"click");}this._oHourStepper.attach("change",$Fn(function(i,h){if(h.condition=="underflow"){this._oHourStepper.decrement(1);}else{if(h.condition=="overflow"){this._oHourStepper.increment(1);}else{if(h.condition=="prev"){if(this._endDate){this._endDate.setTime(this._endDate.getTime()-1000*60*60);}}else{if(h.condition=="next"){if(this._endDate){this._endDate.setTime(this._endDate.getTime()+1000*60*60);}}else{this._changeBtnClass();}}}}},this).bind(this));this._oMinuteStepper.attach("change",$Fn(function(i,h){if(h.condition=="underflow"){this._oHourStepper.decrement(1);}else{if(h.condition=="overflow"){this._oHourStepper.increment(1);}else{if(h.condition=="prev"){if(this._endDate){this._endDate.setTime(this._endDate.getTime()-1000*60);}}else{if(h.condition=="next"){if(this._endDate){this._endDate.setTime(this._endDate.getTime()+1000*60);}}else{this._changeBtnClass();}}}}},this).bind(this));this._oSecondStepper.attach("change",$Fn(function(i,h){if(h.condition=="underflow"){this._oMinuteStepper.decrement(1);}else{if(h.condition=="overflow"){this._oMinuteStepper.increment(1);}else{if(h.condition=="prev"){if(this._endDate){this._endDate.setTime(this._endDate.getTime()-1000);}}else{if(h.condition=="next"){if(this._endDate){this._endDate.setTime(this._endDate.getTime()+1000);}}else{this._changeBtnClass();}}}}},this).bind(this));},_configure:function(){this._isTimeSetting=false;this._changeBtnClass();},_onClickBtnAddTimesHandler:function(b){b.stopDefault();var d=b.currentElement;var a=jindo.$A(this._htElement.btnAddTimes);var c=a.indexOf(d);if(this._isRun){switch(c){case 0:this._endDate.setSeconds(this._endDate.getSeconds()+10);break;case 1:this._endDate.setMinutes(this._endDate.getMinutes()+1);break;case 2:this._endDate.setMinutes(this._endDate.getMinutes()+5);break;case 3:this._endDate.setMinutes(this._endDate.getMinutes()+10);break;case 4:this._endDate.setMinutes(this._endDate.getMinutes()+30);break;case 5:if(this._oHourStepper.getValue()<99){this._endDate.setTime(this._endDate.getTime()+1000*60*60);}break;default:break;}this._changeRuningTime();}else{switch(c){case 0:this._oSecondStepper.increment(10);break;case 1:this._oMinuteStepper.increment(1);break;case 2:this._oMinuteStepper.increment(5);break;case 3:this._oMinuteStepper.increment(10);break;case 4:this._oMinuteStepper.increment(30);break;case 5:this._oHourStepper.increment(1);break;default:break;}}},_onClickBtnRunHandler:function(a){if(!this._htElement.wBtnRun.hasClass("off")){this._switchRun();}},_onClickBtnResetHandler:function(a){if(!this._htElement.wBtnReset.hasClass("off")){this._reset();}},_onClickAlertCloseHandler:function(a){this._closeAlert();},_onClickOpenTimerPopup:function(b){b.stopDefault();if(this._isRun||this._isTimeSetting){var a=window.confirm("팝업창에서는 시간을 재설정해야 합니다.\n팝업으로 사용하시겠습니까?");if(a){this._openPopup();}}else{if(this.popupWindow&&!this.popupWindow.closed){this.popupWindow.focus();}else{this._openPopup();}}},_onClickCloseWindow:function(a){console.log();a.stopDefault();window.close();},_switchRun:function(){var e=this._htElement.wBtnRun;var d=this._htElement.wBtnReset;this._isRun=!this._isRun;if(this._isRun){var f=this._oHourStepper.getValue();var g=this._oMinuteStepper.getValue();var c=this._oSecondStepper.getValue();this._endDate=new Date((new Date()).getTime()+(f*60*60+g*60+c)*1000);var a=this;this._timer=setInterval(function(){a._changeRuningTime();},500);if(e.hasClass("btn_start")){var b=(f)?f+"시간 ":"";b+=(g)?g+"분 ":"";b+=(c)?c+"초 ":"";this._htElement.wAlertTime.text(b);}e.removeClass("btn_start");e.addClass("btn_stop");e.removeClass("btn_restart");d.addClass("off");}else{clearInterval(this._timer);e.removeClass("btn_start");e.removeClass("btn_stop");e.addClass("btn_restart");d.removeClass("off");}this._oHourStepper.setLocked(this._isRun);this._oMinuteStepper.setLocked(this._isRun);this._oSecondStepper.setLocked(this._isRun);},_changeRuningTime:function(){var b=new Date();var a=Math.floor((this._endDate.getTime()-b.getTime())/1000);var d=Math.floor(a/60/60);var e=Math.floor((a-(d*60*60))/60);var c=a%60;this._oSecondStepper.setValue(c);this._oMinuteStepper.setValue(e);this._oHourStepper.setValue(d);if(this.option("isPopup")){if(a===0){document.title="타이머";}else{document.title=d+":"+e+":"+c;}}},_changeBtnClass:function(){var b=this._htElement.wBtnRun;var a=this._htElement.wBtnReset;if(this._oHourStepper.getValue()===0&&this._oMinuteStepper.getValue()===0&&this._oSecondStepper.getValue()===0){if(this._isRun){this._showTimeOut();}b.addClass("btn_start");b.removeClass("btn_stop");b.removeClass("btn_restart");b.addClass("off");a.addClass("off");this._isTimeSetting=false;}else{b.removeClass("off");if(!this._isRun){a.removeClass("off");}this._isTimeSetting=true;}},_showTimeOut:function(){this._htElement.wAlert.show();this._switchRun();},_reset:function(){this._oHourStepper.reset();this._oMinuteStepper.reset();this._oSecondStepper.reset();},_closeAlert:function(){this._htElement.wAlert.hide();},_openPopup:function(){var a=this.option("popupInfo");this.popupWindow=window.open(a.url,"timer_popup","width="+a.width+", height="+a.height+", toolbar=0, scrollbars=0, location=0, status=0, menubar=0, resizable=0");}}).extend(jindo.Component);